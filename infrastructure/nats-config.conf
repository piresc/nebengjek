# NebengJek NATS Server Configuration

# Basic server properties
port: 4222
http_port: 8222
server_name: nebengjek-nats

# Logging settings
debug: false
trace: false
logtime: true
log_file: "/var/log/nats/nats-server.log"

# Connection limits and security
max_connections: 10000
max_control_line: 4096
max_payload: 1048576  # 1MB
max_pending: 67108864  # 64MB
write_deadline: "2s"

# TLS configuration (commented out for development)
# tls {
#   cert_file: "/etc/nats/certs/server-cert.pem"
#   key_file: "/etc/nats/certs/server-key.pem"
#   ca_file: "/etc/nats/certs/ca.pem"
#   verify: true
#   timeout: 2
# }

# Clustering
cluster {
  name: "nebengjek-nats-cluster"
  listen: 0.0.0.0:6222
  routes: [
    "nats://nats-1:6222",
    "nats://nats-2:6222",
    "nats://nats-3:6222"
  ]
  
  # TLS configuration for cluster (commented out for development)
  # tls {
  #   cert_file: "/etc/nats/certs/cluster-server-cert.pem"
  #   key_file: "/etc/nats/certs/cluster-server-key.pem"
  #   ca_file: "/etc/nats/certs/ca.pem"
  #   verify: true
  # }
}

# JetStream configuration
jetstream {
  store_dir: "/data/jetstream"
  max_memory_store: 8589934592  # 8GB
  max_file_store: 1073741824000  # 1TB
}

# NATS monitoring
http: 0.0.0.0:8222

# Observability
websocket {
  port: 8080
  no_tls: true
}

# System accounts
accounts {
  SYS: {
    users: [
      {user: system, password: $SYSTEM_PASSWORD}
    ]
  }
  
  USER: {
    users: [
      {user: user_service, password: $USER_SERVICE_PASSWORD}
    ],
    exports: [
      {stream: user.>}
    ]
  }
  
  LOCATION: {
    users: [
      {user: location_service, password: $LOCATION_SERVICE_PASSWORD}
    ],
    exports: [
      {stream: location.>}
    ]
  }
  
  MATCH: {
    users: [
      {user: match_service, password: $MATCH_SERVICE_PASSWORD}
    ],
    exports: [
      {stream: match.>}
    ]
  }
  
  RIDES: {
    users: [
      {user: rides_service, password: $RIDES_SERVICE_PASSWORD}
    ],
    exports: [
      {stream: ride.>}
    ]
  }
}